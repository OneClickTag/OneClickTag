import { typedApiClient } from '../typed-client';
import { components } from '../generated/schema';
import { ApiRequestConfig } from '../types';

// Extract query parameter types for customer list
type CustomerListQuery = {
  page?: number;
  limit?: number;
  search?: string;
  status?: 'active' | 'inactive' | 'pending';
  tags?: string[];
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
};

export class TypedCustomerService {
  /**
   * Get paginated list of customers with type-safe filtering
   */
  async getCustomers(query?: CustomerListQuery, config?: ApiRequestConfig) {
    return typedApiClient.get('/api/customers', {
      query,
      config,
    });
  }

  /**
   * Get a single customer by ID
   */
  async getCustomer(id: string, config?: ApiRequestConfig) {
    return typedApiClient.get('/api/customers/{id}', {
      params: { id },
      config,
    });
  }

  /**
   * Create a new customer
   */
  async createCustomer(data: CreateCustomerRequest, config?: ApiRequestConfig) {
    return typedApiClient.post('/api/customers', {
      data,
      config,
    });
  }

  /**
   * Update an existing customer
   */
  async updateCustomer(
    id: string, 
    data: UpdateCustomerRequest, 
    config?: ApiRequestConfig
  ) {
    return typedApiClient.put('/api/customers/{id}', {
      params: { id },
      data,
      config,
    });
  }

  /**
   * Partially update a customer
   */
  async patchCustomer(
    id: string, 
    data: Partial<UpdateCustomerRequest>, 
    config?: ApiRequestConfig
  ) {
    return typedApiClient.patch('/api/customers/{id}', {
      params: { id },
      data,
      config,
    });
  }

  /**
   * Delete a customer
   */
  async deleteCustomer(id: string, config?: ApiRequestConfig) {
    return typedApiClient.delete('/api/customers/{id}', {
      params: { id },
      config,
    });
  }

  /**
   * Bulk delete customers
   */
  async bulkDeleteCustomers(
    data: { ids: string[] }, 
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/bulk-delete', {
      data,
      config,
    });
  }

  /**
   * Export customers to various formats
   */
  async exportCustomers(
    query?: {
      format?: 'csv' | 'excel' | 'pdf';
      includeFields?: string[];
    } & CustomerListQuery,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/export', {
      data: query,
      config,
    });
  }

  /**
   * Connect Google account for customer
   */
  async connectGoogleAccount(
    id: string,
    data: { authCode: string },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/{id}/google/connect', {
      params: { id },
      data,
      config,
    });
  }

  /**
   * Disconnect Google account for customer
   */
  async disconnectGoogleAccount(id: string, config?: ApiRequestConfig) {
    return typedApiClient.post('/api/customers/{id}/google/disconnect', {
      params: { id },
      config,
    });
  }

  /**
   * Get customer analytics
   */
  async getCustomerAnalytics(
    id: string,
    query?: {
      startDate?: string;
      endDate?: string;
      metrics?: string[];
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/{id}/analytics', {
      params: { id },
      query,
      config,
    });
  }

  /**
   * Get customer activities/events
   */
  async getCustomerActivities(
    id: string,
    query?: {
      page?: number;
      limit?: number;
      activityType?: string;
      startDate?: string;
      endDate?: string;
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/{id}/activities', {
      params: { id },
      query,
      config,
    });
  }

  /**
   * Validate customer data
   */
  async validateCustomer(
    data: CreateCustomerRequest | UpdateCustomerRequest,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/validate', {
      data,
      config,
    });
  }

  /**
   * Check email availability
   */
  async checkEmailAvailability(
    email: string,
    excludeId?: string,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/check-email', {
      query: { email, excludeId },
      config,
    });
  }

  /**
   * Get tag suggestions for customers
   */
  async getTagSuggestions(
    query?: string,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/tag-suggestions', {
      query: { query },
      config,
    });
  }

  /**
   * Merge multiple customers into one
   */
  async mergeCustomers(
    primaryId: string,
    data: { secondaryIds: string[] },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/{id}/merge', {
      params: { id: primaryId },
      data,
      config,
    });
  }

  /**
   * Duplicate a customer
   */
  async duplicateCustomer(
    id: string,
    data?: Partial<CreateCustomerRequest>,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/{id}/duplicate', {
      params: { id },
      data: data || {},
      config,
    });
  }

  /**
   * Upload customer avatar
   */
  async uploadAvatar(
    id: string,
    file: File,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.upload(`/api/customers/${id}/avatar`, file, config);
  }

  /**
   * Get customer statistics and insights
   */
  async getCustomerStats(
    query?: {
      startDate?: string;
      endDate?: string;
      groupBy?: 'day' | 'week' | 'month';
      includeComparison?: boolean;
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/stats', {
      query,
      config,
    });
  }

  /**
   * Get customer insights and recommendations
   */
  async getCustomerInsights(
    id: string,
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/{id}/insights', {
      params: { id },
      config,
    });
  }

  /**
   * Set customer preferences
   */
  async updateCustomerPreferences(
    id: string,
    data: {
      emailNotifications?: boolean;
      smsNotifications?: boolean;
      marketingConsent?: boolean;
      preferredLanguage?: string;
      timezone?: string;
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.patch('/api/customers/{id}/preferences', {
      params: { id },
      data,
      config,
    });
  }

  /**
   * Add note to customer
   */
  async addCustomerNote(
    id: string,
    data: {
      content: string;
      type?: 'general' | 'support' | 'sales' | 'technical';
      isPrivate?: boolean;
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.post('/api/customers/{id}/notes', {
      params: { id },
      data,
      config,
    });
  }

  /**
   * Get customer notes
   */
  async getCustomerNotes(
    id: string,
    query?: {
      page?: number;
      limit?: number;
      type?: string;
      includePrivate?: boolean;
    },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.get('/api/customers/{id}/notes', {
      params: { id },
      query,
      config,
    });
  }

  /**
   * Archive/unarchive customer
   */
  async toggleCustomerArchive(
    id: string,
    data: { archived: boolean },
    config?: ApiRequestConfig
  ) {
    return typedApiClient.patch('/api/customers/{id}/archive', {
      params: { id },
      data,
      config,
    });
  }
}

// Create and export singleton instance
export const typedCustomerService = new TypedCustomerService();

// Export the class for creating custom instances
export default TypedCustomerService;